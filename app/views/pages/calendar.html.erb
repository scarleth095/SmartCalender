
<style>
    *{
        outline:none !important;
         text-decoration:none !important;
        font-family: 'Work Sans', sans-serif;
    }
table { table-layout: fixed; }
th { width: 33%;
    font-weight: bold;
    }
    .days{
        height:100px;
        
    }
    #year{
        font-size:25px;
        text-align:right;
        border-left:none;
    }
    #month{
        font-size:25px;
   
        border-right:none;
    }
    td a {
        text-decoration:none !important;
        color:black;
    display:block;
    width:100%;
        height:100px;
}
    .weathericon{
        font-size:20px;
        position:relative;
        left:75%;
       

     
    }
    #info{
        position:relative;
        top:20px;
    }
    #weathertoday{
         border-right:none;
    }
    #infotoday{
         border-left:none;
        text-align:right;
    }#infotoday1{
         border-left:none;
         border-right:none;
        text-align:left;
    }
    #today{
        font-size:20px;
    }
    #todayicon{
        font-size:45px;
    }
    #music{
       
    }
    
</style>

 <% @date = Date.today  %> 

  <table class="table table-bordered">
    <thead>
        <tr id="today">
        <td  id="weathertoday" colspan="2">
          <i id="todayicon"></i>&nbsp; <span id="todaydesc"></span> <span id="todaytempday"></span> 
            
        </td>
            <td id="music" colspan="3">
               <iframe style="border:none" src="http://files.podsnack.com/iframe/embed.html?hash=a1nfbsll&t=1476142365" width="100%" height="54" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
            </td>
            <td id="infotoday1" colspan="1" >
                <span id="info"> &nbsp;&nbsp;&nbsp;<span id="todaysunrise"></span></span>
                  
            </td>
            <td id="infotoday" colspan="1" >
                <span id="info"><span id="todaysunset">&nbsp;&nbsp;&nbsp;&nbsp;</span></span>
                  
            </td>
        </tr>
        <tr>
         
            <td id="month" colspan="4">
           
            
            <%= @date.strftime("%B")%>
                    
                   
                </td>
            
             <td colspan="3" id="year">
                 
                  <%= @date.year%>
            </td>
          
        </tr>
      <tr class="week">
          <% 7.times do |i| %>
        <th> <%= Date::DAYNAMES[i] %></th>
          <%end %>
      </tr>
    </thead>
    <tbody>
        <% y =0%>
        <% 6.times do |i| %>
        <tr>
            <% 7.times do |x| %>
            <td class="days">
               
                <%if i==0 and x==Date.today.beginning_of_month.wday%>
                <% y=1 %>  <a onclick="modal(<%=y%>)"><%=y%>  <i class="weathericon"  id="<%=y%>"></i></a>
                <%else%>
                <% if y!=0 and y!=Date.today.end_of_month.day %>
                <% y+=1 %>  <a onclick="modal(<%=y%>)"> <%= y %> <i class="weathericon" id="<%=y%>"></i></a>
                <%end%>
                <%end %>
                
            </td>
          <%end %>
            
        
        </tr>
        <%end %>
    
    </tbody>
      
      
  </table>



  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 id="datemodal" class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <p>Events</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
</div>

<div id="demo"></div>
<script>
    
    
    
    var url="http://api.openweathermap.org/data/2.5/forecast/daily?";
    var lat="";
    var lon="";
    var forecast=[]
    var icons={"01d":"wi-day-sunny", "01n":"wi-night-clear", "02d":"wi-day-cloudy", "02n":"wi-night-alt-cloudy", "03d":"wi-cloud", "03n":"wi-cloud", "04d":"wi-cloudy","04n":"wi-cloudy","09d":"wi-rain", "09n":"wi-rain", "10d":"wi-day-rain", "10n":"wi-night-alt-rain","11d":"wi-thunderstorm", "11n":"wi-thunderstorm","13d":"wi-day-snow", "13n":"wi-night-snow","50d":"wi-fog","50n":"wi-fog"}
    
    
    
    var options = {
  enableHighAccuracy: true,
  timeout: 5000,
  maximumAge: 0
};

function success(pos) {
  var crd = pos.coords;

 lat= crd.latitude;
 lon=crd.longitude;
 url=url+"lat="+lat+"&lon="+lon+"&cnt=7&mode=json&appid=eccff7e6a1be7793a5f98da9fa745b6a";
 var url2= "http://api.openweathermap.org/data/2.5/weather?lat="+lat+"&lon="+lon+"&appid=eccff7e6a1be7793a5f98da9fa745b6a";
 getData(url, url2);
};

function error(err) {
  console.warn('ERROR(' + err.code + '): ' + err.message);
};

navigator.geolocation.getCurrentPosition(success, error, options);
    
    
function modal(day){
    $("#myModal").modal('show');
    $("#datemodal").html("<%= @date.strftime("%B")%> "+day+", <%= @date.year%>");
}

function getData(url,url2){
    $.getJSON( url, {
    format: "json"
  })
    .done(function( data ) {
      
       console.log( "JSON Data: "+ data.list[0].weather[0].description)
       for(var i=0; i<7 ;i++){
           var tempDay=Math.round(data.list[i].temp.day* 9/5 - 459.67);
           var tempMax=Math.round(data.list[i].temp.max* 9/5 - 459.67);
           var tempMin= Math.round(data.list[i].temp.min* 9/5 - 459.67);
           var desc= data.list[i].weather[0].description;
           var icon= data.list[i].weather[0].icon;
           console.log(icon);
           console.log(icons[icon]);
           $("#"+(i+<%=Date.today.day%>)).addClass("wi");
           $("#"+(i+<%=Date.today.day%>)).addClass(icons[icon]);

       }
                   
      });
      $.getJSON( url2, {
    format: "json"
  })
    .done(function( data ) {
          icon= data.weather[0].icon;
          desc= data.weather[0].description;
          tempDay=Math.round(data.main.temp* 9/5 - 459.67);
            tempMax=Math.round(data.main.temp_max* 9/5 - 459.67);
           tempMin= Math.round(data.main.temp_min* 9/5 - 459.67);
          var sunrise=data.sys.sunrise;
          
          var sunset= data.sys.sunset;
           $("#todayicon").addClass("wi");
           $("#todayicon").addClass(icons[icon]);
          $("#todaydesc").html(desc.toUpperCase());
          $("#todaytempday").html(tempDay+"<i class='wi wi-fahrenheit'></i>");
          $("#todaytempmax").html(tempMax);
          $("#todaytempmin").html(tempMin);
var timestamp = sunrise;
var date = new Date(timestamp * 1000);
var hour=date.getHours();
var min= (date.getMinutes() < 10) ? ("0" + date.getMinutes()) : date.getMinutes();

var timestamp2 = sunset;
var date2 = new Date(timestamp2 * 1000);
var hour2=date2.getHours()-12;
var min2=(date2.getMinutes() < 10) ? ("0" + date2.getMinutes()) : date2.getMinutes();
  
          
          $("#todaysunrise").html("<i class='wi wi-sunrise'></i> "+hour+":"+min+" AM ");
          $("#todaysunset").html("<i class='wi wi-sunset'></i> "+hour2+":"+min2+" PM ");
          
           
          
        
       
                   
      });
    
   
}

</script>

